<template>
    <div class="commit-box">
        <div class="header">
            <span v-for="letter in curStrs" :key="letter">{{ letter }}</span>
        </div>
        <!-- input -->
        <input type="file" ref="UploadRef" style="display: none;" @change="handleFileUpload">
        <div class="uploads">
            <div class="upload-item wow fadeInUp" data-wow-delay="0s"
            @click="handleCommit(0)">
                <div class="title">
                    <div class="icon">
                        <svg t="1710346224206" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5139" width="26" height="26"><path d="M742.4 139.264q27.648 24.576 44.032 41.472t25.088 28.672 10.752 19.968 2.048 14.336l0 16.384-150.528 0q-11.264 0-18.944-7.68t-12.8-17.92-7.68-20.992-2.56-17.92l0-125.952 2.048 0q9.216 0 17.408 2.048t19.968 9.728 28.672 21.504 42.496 36.352zM567.296 197.632q0 19.456 6.144 41.984t19.456 41.472 33.792 31.744 48.128 12.8l149.504 0 0 513.024q0 29.696-11.776 53.248t-31.232 40.448-43.008 26.112-46.08 9.216l-441.344 0q-19.456 0-42.496-11.264t-43.008-29.696-33.28-42.496-13.312-49.664l0-632.832q0-21.504 10.24-45.056t27.136-42.496 38.4-31.744 45.056-12.8l327.68 0 0 128zM485.376 659.456q12.288-12.288 13.312-32.768t-11.264-31.744l-167.936-168.96q-12.288-12.288-30.208-12.288t-30.208 12.288q-12.288 13.312-12.288 31.232t12.288 30.208l137.216 139.264-137.216 138.24q-12.288 12.288-12.288 30.208t12.288 31.232q12.288 12.288 30.208 12.288t30.208-12.288zM695.296 773.12l-192.512 0 0 64.512 192.512 0 0-64.512z" p-id="5140" fill="#ffffff"></path></svg>
                    </div>
                    <span>智能合约源代码</span>
                </div>
                <div v-if="file[0]" class="suc wow fadeInUp">
                    <svg t="1710348243868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13692" width="32" height="32"><path d="M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m260.654545 425.425455l-279.272727 279.272727c-5.585455 5.585455-13.032727 9.309091-21.410909 9.309091-10.24 1.861818-20.48-0.930909-27.927273-8.378182l-175.941818-176.872727a30.906182 30.906182 0 0 1 0-43.752728l14.894546-14.894545c12.101818-12.101818 31.650909-12.101818 43.752727 0l141.498182 141.498182 244.829091-244.829091c12.101818-12.101818 31.650909-12.101818 43.752727 0L772.654545 381.672727c12.101818 12.101818 12.101818 31.650909 0 43.752728z" fill="#06b712" p-id="13693"></path></svg>
                </div>
            </div>
            <div class="upload-item wow fadeInUp" data-wow-delay="0.2s"
            @click="handleCommit(1)">
                <div class="title">
                    <div class="icon">
                        <svg t="1710346433560" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6414" width="26" height="26"><path d="M316.5952 959.49824c-20.45952 0-38.98368-4.69504-55.06048-13.96224-60.1856-34.67264-79.27808-128.80896-52.608-258.65728-125.60384-41.8304-197.53472-105.46688-197.53472-174.96576 0-69.55008 71.91552-133.16096 197.53984-174.90432-26.48064-129.73568-7.33184-223.86688 52.7616-258.65216 16.03072-9.27744 34.5344-13.98272 54.99392-13.98272 55.13216 0 124.36992 34.61632 195.31776 97.58208 70.96832-62.93504 140.16512-97.536 195.22048-97.536 20.4544 0 38.98368 4.69504 55.07072 13.96736 60.11904 34.6368 79.26784 128.7168 52.77184 258.49344 125.6192 41.90208 197.53984 105.58976 197.53984 175.11424 0 69.5808-71.92576 133.18144-197.53472 174.8736 26.64448 129.83296 7.49056 223.96416-52.77696 258.65216-16.06144 9.24672-34.56512 13.93664-54.99904 13.93664-55.14752 0-124.37504-34.6368-195.29728-97.62816-70.98368 63.01696-140.24704 97.664-195.4048 97.66912z m239.67744-140.68736c59.17184 50.31936 116.224 80.2304 153.3184 80.2304 9.0368 0 16.71168-1.792 22.81472-5.31456l1.79712-1.03424c30.6944-20.20864 38.98368-93.52704 21.3504-188.89216a951.88992 951.88992 0 0 1-120.68352 21.12 935.296 935.296 0 0 1-78.59712 93.89056z m-264.68352 74.9056c6.07744 3.5072 13.71136 5.28384 22.69184 5.28384 36.99712 0 93.9264-29.96224 152.97024-80.36352a955.43808 955.43808 0 0 1-78.12608-93.88032 966.28736 966.28736 0 0 1-120.832-20.83328c-17.83296 97.14688-8.81664 171.35616 23.28576 189.7984l0.01024-0.00512z m177.84832-163.06688a842.76736 842.76736 0 0 0 42.40384 46.45888 820.52096 820.52096 0 0 0 42.59328-46.208c-14.73536 0.55296-28.71296 0.82944-42.43456 0.82944-12.73344 0-26.1888-0.33792-42.56256-1.08032z m-48.58368-61.96736c30.208 3.13344 60.87168 4.80256 91.17184 4.95104 30.24384 0 60.78976-1.50016 90.80832-4.4544a940.52352 940.52352 0 0 0 49.08032-76.36992 896.07168 896.07168 0 0 0 41.43104-81.55136 956.86144 956.86144 0 0 0-41.2672-80.13312l-0.68608-1.19296a937.60512 937.60512 0 0 0-48.2304-74.76224 933.7344 933.7344 0 0 0-91.19232-4.93568c-30.24896 0-60.78464 1.49504-90.80832 4.43392a945.3568 945.3568 0 0 0-49.24928 76.44672 936.8832 936.8832 0 0 0-41.26208 81.29536c13.17888 28.71808 26.74176 55.03488 41.42592 80.39424a977.1008 977.1008 0 0 0 48.77824 75.8784z m271.83616-30.59712a1170.40128 1170.40128 0 0 1-12.38528 20.10112 850.19136 850.19136 0 0 0 61.42464-13.76768 840.27904 840.27904 0 0 0-18.95936-60.11904 915.31264 915.31264 0 0 1-20.5312 37.62688l-9.5488 16.50176v-0.34304z m-410.42432 6.48704c17.71008 4.64384 37.85216 9.00096 61.14816 13.23008a1014.34368 1014.34368 0 0 1-21.66784-35.968 1499.22816 1499.22816 0 0 1-20.43392-36.84864c-8.15104 23.00416-14.3104 42.2656-19.0464 59.58656zM224.0256 397.3376C130.99008 430.30528 71.18336 475.0592 71.18336 512c0 37.01248 59.74016 81.85856 152.6784 114.9184a948.49536 948.49536 0 0 1 42.22464-114.95424 945.80224 945.80224 0 0 1-42.0608-114.62656z m533.88288 114.41152a975.59552 975.59552 0 0 1 42.21952 114.84672c92.94336-33.0496 152.68352-77.77792 152.68352-114.6112 0-36.51072-61.19424-82.42688-152.83712-115.00032a968.2688 968.2688 0 0 1-42.06592 114.7648z m-475.63264-132.352a846.19776 846.19776 0 0 0 18.95424 59.93984c6.08768-11.73504 12.91264-24.53504 20.37248-37.3248a1327.75936 1327.75936 0 0 1 21.96992-36.36224 826.112 826.112 0 0 0-61.29664 13.7472z m398.45376-13.25568c7.91552 12.6208 14.88896 24.05888 21.6832 35.968a1462.40512 1462.40512 0 0 1 20.26496 36.59264c8.16128-22.96832 14.3104-42.1632 19.04128-59.392-17.58208-4.608-37.29408-8.86784-60.98944-13.16864zM291.59424 130.26816c-32.00512 18.49856-40.96 92.73344-23.13728 189.8752a954.04544 954.04544 0 0 1 120.50944-21.0944A955.1104 955.1104 0 0 1 467.57376 205.1584C408.576 154.81344 351.60064 124.88192 314.496 124.88192c-8.4736 0-15.7696 1.57184-21.70368 4.66432l-1.19808 0.72192z m343.4496 168.81152a966.1952 966.1952 0 0 1 120.4992 20.81792c17.57184-95.67232 9.1136-169.10848-21.79072-188.86144l-1.34656-0.768c-6.08256-3.51232-13.73184-5.28896-22.72256-5.28896-36.98688 0-93.9008 29.90592-152.91904 80.21504a939.1104 939.1104 0 0 1 78.27968 93.88544z m-122.42944-7.02464c14.33088 0 28.81536 0.49152 42.04544 1.08544a896.9216 896.9216 0 0 0-42.53696-46.42816 821.6576 821.6576 0 0 0-42.56256 46.18752c14.41792-0.54784 28.64128-0.82944 42.42944-0.8448h0.62464z m-0.6144 258.09408c-21.03808 0-38.15424-17.11616-38.15424-38.14912 0-21.03808 17.11616-38.15424 38.15424-38.15424 21.03296 0 38.14912 17.11616 38.14912 38.15424 0 21.03296-17.11616 38.14912-38.14912 38.14912z" p-id="6415" fill="#ffffff"></path></svg>
                    </div>
                    <span>交易数据</span>
                </div>
                <div v-if="file[1]" class="suc wow fadeInUp">
                    <svg t="1710348243868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13692" width="32" height="32"><path d="M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m260.654545 425.425455l-279.272727 279.272727c-5.585455 5.585455-13.032727 9.309091-21.410909 9.309091-10.24 1.861818-20.48-0.930909-27.927273-8.378182l-175.941818-176.872727a30.906182 30.906182 0 0 1 0-43.752728l14.894546-14.894545c12.101818-12.101818 31.650909-12.101818 43.752727 0l141.498182 141.498182 244.829091-244.829091c12.101818-12.101818 31.650909-12.101818 43.752727 0L772.654545 381.672727c12.101818 12.101818 12.101818 31.650909 0 43.752728z" fill="#06b712" p-id="13693"></path></svg>
                </div>
            </div>
            <div class="upload-item wow fadeInUp" data-wow-delay="0.4s"
            @click="handleCommit(2)">
                <div class="title">
                    <div class="icon">
                        <svg t="1710346515868" class="icon" viewBox="0 0 1056 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7661" width="26" height="26"><path d="M10.955762 512.623801h80.286179a10.95574 10.95574 0 0 1 10.95574 10.976708v12.150911a10.95574 10.95574 0 0 1-10.95574 10.913805H10.955762A10.95574 10.95574 0 0 1 0.000023 535.709485v-12.108976a10.95574 10.95574 0 0 1 10.955739-10.976708z m0-340.309396h80.286179a10.95574 10.95574 0 0 1 10.95574 10.95574v12.182363a10.95574 10.95574 0 0 1-10.95574 10.95574H10.955762A10.95574 10.95574 0 0 1 0.000023 195.452508V183.270145a10.95574 10.95574 0 0 1 10.955739-10.95574z m0 170.207118h80.286179a10.95574 10.95574 0 0 1 10.95574 10.95574v12.150911a10.95574 10.95574 0 0 1-10.95574 10.95574H10.955762A10.95574 10.95574 0 0 1 0.000023 365.628174v-12.140427a10.95574 10.95574 0 0 1 10.955739-10.95574z m0 340.183588h80.286179a10.95574 10.95574 0 0 1 10.95574 10.95574v12.150912a10.95574 10.95574 0 0 1-10.95574 10.95574H10.955762A10.95574 10.95574 0 0 1 0.000023 705.811763v-12.140428a10.95574 10.95574 0 0 1 10.955739-10.95574z m-10.955739 0" p-id="7662" fill="#ffffff"></path><path d="M815.06514 68.019954H755.159783a8.554913 8.554913 0 0 1-8.523461-7.579904A68.082847 68.082847 0 0 0 679.035737 0.00001H108.980804a76.606308 76.606308 0 0 0-76.63776 76.616792v50.826247a8.586365 8.586365 0 0 0 8.586365 8.586364h50.83673a42.65924 42.65924 0 0 1 42.690692 42.648756v25.476027a34.135779 34.135779 0 0 1-34.062391 34.062392H40.971345a8.586365 8.586365 0 0 0-8.628301 8.607332v50.836731a8.586365 8.586365 0 0 0 8.586365 8.586364h50.83673a42.65924 42.65924 0 0 1 42.65924 42.65924v16.889663a42.65924 42.65924 0 0 1-42.65924 42.65924H40.971345a8.586365 8.586365 0 0 0-8.586365 8.586364v50.826247a8.586365 8.586365 0 0 0 8.586365 8.586364h50.83673a42.65924 42.65924 0 0 1 42.65924 42.65924v25.455059a34.135779 34.135779 0 0 1-34.062391 34.072876H40.971345a8.586365 8.586365 0 0 0-8.586365 8.586364v50.952054a8.586365 8.586365 0 0 0 8.586365 8.586365h50.83673a42.65924 42.65924 0 0 1 42.65924 42.65924v25.24538a34.135779 34.135779 0 0 1-34.062391 34.062391H40.971345a8.586365 8.586365 0 0 0-8.628301 8.659752v119.034901a76.606308 76.606308 0 0 0 76.606308 76.606308h697.529423a76.606308 76.606308 0 0 0 76.606308-76.606308V136.039897a68.072363 68.072363 0 0 0-68.019943-68.009459z m-295.867883 84.689442c8.387169-14.174316 33.118835-20.496145 47.639122-12.507366l81.240219 45.500394c14.530771 8.219426 21.209054 32.164794 12.863821 46.33911L404.230133 665.783997a8.586365 8.586365 0 0 1-11.584777 3.145189l-126.751097-70.934485a8.586365 8.586365 0 0 1-3.145189-11.867845zM365.009633 708.894048l-103.067828 38.297912a8.586365 8.586365 0 0 1-11.532358-7.338774l-8.387169-100.56216a8.586365 8.586365 0 0 1 12.748497-8.208942l111.423545 62.264248a8.586365 8.586365 0 0 1-1.184687 15.547716z m450.055507 141.806065c0 37.522099-2.096792 68.009459-68.00946 68.00946H134.456831a68.145751 68.145751 0 0 1-67.29655-58.1126 8.617817 8.617817 0 0 1 8.502493-9.89686h594.671275a76.606308 76.606308 0 0 0 76.606308-76.606308V110.825969a8.607333 8.607333 0 0 1 8.701688-8.596848c33.42287 0.345971 59.307771 4.990366 59.307771 67.988491v680.482501z m0 0" p-id="7663" fill="#ffffff"></path></svg>
                    </div>
                    <span>事件日志</span>
                </div>
                <div v-if="file[2]" class="suc wow fadeInUp">
                    <svg t="1710348243868" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="13692" width="32" height="32"><path d="M512 0C229.003636 0 0 229.003636 0 512s229.003636 512 512 512 512-229.003636 512-512S794.996364 0 512 0z m260.654545 425.425455l-279.272727 279.272727c-5.585455 5.585455-13.032727 9.309091-21.410909 9.309091-10.24 1.861818-20.48-0.930909-27.927273-8.378182l-175.941818-176.872727a30.906182 30.906182 0 0 1 0-43.752728l14.894546-14.894545c12.101818-12.101818 31.650909-12.101818 43.752727 0l141.498182 141.498182 244.829091-244.829091c12.101818-12.101818 31.650909-12.101818 43.752727 0L772.654545 381.672727c12.101818 12.101818 12.101818 31.650909 0 43.752728z" fill="#06b712" p-id="13693"></path></svg>
                </div>
            </div>
        </div>
        <!-- loading -->
        <Loading style="margin-top: 240px;" v-if="isLoding"></Loading>
        <!-- result -->
        <Result v-if="file.length == 3 && !isLoding" @change="() => isShowShap = true"></Result>
        <Shap v-if="isShowShap" @change="() => isShowShap = false"></Shap>

    </div>
</template>


<script setup>
import { onMounted, ref, watch } from 'vue';
import { useCoding } from '../../hooks/useCoding';
import useWow from '../../hooks/useWow';
import Result from './components/Result.vue';
import Loading from './components/Loading.vue';
import Shap from "./components/Shap.vue";

const {
    curStrs,
    startCoding
} = useCoding('请上传智能合约源代码、交易数据和事件日志。', 200)

const UploadRef = ref(null)
const file = ref([])
const fileIndex = ref(0)
const isLoding = ref(false)
const isShowShap = ref(false)

const handleCommit = (index) => {
    fileIndex.value = index
    UploadRef.value.click()
}

const handleChangeLoading = () => {
    console.log(file.value)
    if (file.value[0] && file.value[1] && file.value[2]) {
        isLoding.value = true
    }
}

watch(isLoding, () => {
    if (isLoding.value) {
        setTimeout(() => {
            isLoding.value = false
        }, 7000)
    }
})


const handleFileUpload = (e) => {
    file.value[fileIndex.value] = e.target.files[0]
    handleChangeLoading()
}

onMounted(() => {
    startCoding()
    useWow()
})

</script>



<style scoped lang="scss">
.commit-box {
    width: 100%;
    padding: 3% 10%;
    min-height: 100vh;
    .header {
        width: fit-content;
        margin: 0 auto;
        text-align: center;
        font-size: 2rem;
        @include txt-linear;
        height: 30px;
    }
    .uploads {
        width: 95%;
        margin: 90px auto;
        display: flex;
        gap: 30px;
        justify-content: center;
        .upload-item {
            width: 30%;
            height: 140px;
            background-color: $c-black-light;
            border-radius: 20px;
            cursor: pointer;
            padding: 20px;
            transform: translateY(0);
            transition: .3s ease-out;
            .title {
                display: flex;
                gap: 10px;
                color: $c-text-dark-1;
                align-items: center;
            }
            &:hover {
                transform: translateY(-20px);
            }
            .suc {
                margin-top:  20px;
            }
        }
    }
}
</style>